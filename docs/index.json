[{"uri":"https://QuocTrong21.github.io/FCJ-WorkShop/","title":"Session Management","tags":[],"description":"","content":"Working with Amazon Systems Manager - Session Manager Overview Amazon Systems Manager â€“ Session Manager is a fully managed AWS service that enables secure, auditable, and browser-based shell or CLI access to your Amazon EC2 instances and other AWS resources without requiring an inbound port (such as SSH or RDP) to be open.\nIn this lab, you will:\nLearn the core concepts of Session Manager and its role in secure system administration.\nPractice connecting to public and private EC2 instances in a VPC without using bastion hosts.\nExplore logging and auditing features integrated with AWS CloudTrail and Amazon S3 for compliance.\nUnderstand how Session Manager can improve security posture by eliminating direct inbound connections and centralizing access control.\nThis exercise will help DevOps teams reduce operational risk, simplify infrastructure access management, and enhance overall security visibility.\nContents  Introduction Prerequisites Monitoring Implementation Anomaly Detection Automated Response Escalation Procedures Dashboard Development Operational Procedures  Clean Up Resources  "},{"uri":"https://QuocTrong21.github.io/FCJ-WorkShop/1-introduce/","title":"Introduction","tags":[],"description":"","content":"In the context of modern system development and operation, especially for Java web applications running on the AWS platform, the requirements of fast deployment, high security, scalability, and 24/7 availability have become mandatory standards.\nManual infrastructure configuration involves many risks:\n Time-consuming Lack of consistency Difficult to manage configuration versions Hard to control rollback when issues occur   âš™ï¸ What is Network Automation? Network Automation is the use of tools and scripts to automate the process of creating, configuring, monitoring, and managing network infrastructure.\nWith AWS, this includes:\n Provisioning: Automatically creating VPC, Subnet, Internet Gateway, Route Table, Security Group Configuration: Setting access permissions, ports, security rules Monitoring: Monitoring traffic, CPU, connections Rollback: Quickly restoring when deployment errors happen   ğŸ›  Main Tools in the Project  AWS CLI â€“ Running scripts to create and configure network via command line AWS SDK for Java â€“ Integrating infrastructure management directly from Java applications AWS CloudFormation â€“ Describing the entire infrastructure with YAML files (Infrastructure as Code â€“ IaC)   ğŸ¯ Workshop Goals This workshop will help you:\n Understand how to fully automate AWS network infrastructure for Java web applications Deploy faster, more accurately, and with fewer errors compared to manual operations Combine CLI, Java SDK, and CloudFormation for maximum efficiency Master rollback processes, testing, and configuration version management   âœ… Provisioning \u0026amp; Configuration Automatically create and configure the network from scratch â†’ system ready to run Java web applications\nâœ… Monitoring \u0026amp; Alerting Integrate CloudWatch Alarms and SNS for timely monitoring and alerts\nâœ… Rollback \u0026amp; Version Control Easily revert to stable states when deployment fails, manage configuration history with Git\n ğŸ“š Workshop Content  System Architecture Introduction Environment Preparation Automation with AWS CLI Infrastructure as Code with CloudFormation AWS SDK for Java â€“ Network Management and Monitoring Deployment of Monitoring \u0026amp; Alerting Testing \u0026amp; Rollback   ğŸ§  Final Goal: Build a complete Network Automation framework on AWS for Java web applications â€“ fast, secure, scalable, and easy to manage.\n "},{"uri":"https://QuocTrong21.github.io/FCJ-WorkShop/2-prerequiste/2.1.1-createiam/","title":"ğŸ–¥ï¸ HÆ°á»›ng Dáº«n Táº¡o EC2 Instance TrÃªn AWS","tags":[],"description":"","content":"ğŸ“Œ Má»¥c TiÃªu Táº¡o má»™t EC2 instance sá»­ dá»¥ng cáº¥u hÃ¬nh máº·c Ä‘á»‹nh Ä‘á»ƒ triá»ƒn khai á»©ng dá»¥ng hoáº·c kiá»ƒm thá»­ mÃ´i trÆ°á»ng.\nğŸ§° YÃªu Cáº§u TrÆ°á»›c Khi Báº¯t Äáº§u  TÃ i khoáº£n AWS há»£p lá»‡ ÄÄƒng nháº­p AWS Console hoáº·c cÃ i sáºµn AWS CLI Táº¡o key pair Ä‘á»ƒ SSH (náº¿u cáº§n) c  ğŸ› ï¸ CÃ¡c BÆ°á»›c Thá»±c Hiá»‡n 1. ÄÄƒng Nháº­p AWS Console Truy cáº­p: https://console.aws.amazon.com/ec2/\n2. Táº¡o EC2 Instance CÃ¡ch 1: Qua AWS Console  VÃ o EC2 Dashboard Nháº¥n Launch Instance Nháº­p tÃªn: workshop Chá»n AMI: Amazon Linux 2023 (hoáº·c Amazon Linux 2) Loáº¡i Instance: t2.micro (Free tier) Key pair: Chá»n hoáº·c táº¡o má»›i Network Settings:  Allow SSH (port 22) Allow HTTP (port 80) náº¿u cáº§n   á»” Ä‘Ä©a: Máº·c Ä‘á»‹nh 8 GB (gp2) Nháº¥n Launch Instance   CÃ¡ch 2: DÃ¹ng AWS CLI aws ec2 run-instances --image-id ami-0c02fb55956c7d316 \\ # Amazon Linux 2 (us-east-1) --instance-type t2.micro --key-name my-key --security-groups default --tag-specifications \u0026#39;ResourceType=instance,Tags=[{Key=Name,Value=MyEC2Default}]\u0026#39;  ğŸ“ Ghi chÃº: Thay ami-xxxx vÃ  my-key báº±ng ID vÃ  key pair tÆ°Æ¡ng á»©ng trong region cá»§a báº¡n.\n 3. Káº¿t Ná»‘i EC2 Báº±ng SSH ssh -i my-key.pem ec2-user@\u0026lt;public-ip\u0026gt; âœ… Káº¿t Quáº£  EC2 instance Ä‘Æ°á»£c táº¡o vÃ  cháº¡y trong vÃ i phÃºt. CÃ³ thá»ƒ SSH Ä‘á»ƒ cÃ i Ä‘áº·t thÃªm hoáº·c triá»ƒn khai á»©ng dá»¥ng.   ğŸ§¹ Máº¹o Quáº£n LÃ½  Táº¯t hoáº·c terminate instance sau khi dÃ¹ng Ä‘á»ƒ trÃ¡nh máº¥t phÃ­. Gáº¯n Elastic IP náº¿u muá»‘n giá»¯ IP cá»‘ Ä‘á»‹nh.  ğŸ“š TÃ i Liá»‡u Tham Kháº£o  EC2 User Guide Amazon Linux AMI  "},{"uri":"https://QuocTrong21.github.io/FCJ-WorkShop/2-prerequiste/","title":"Steps to Prepare the Environment for Network Automation on AWS","tags":[],"description":"","content":"\rTo implement network automation on AWS, you need to prepare an environment that includes AWS CLI for interacting with AWS via command line, AWS SDK (Java) for programmatically managing network resources, and AWS CloudFormation for modeling and deploying network infrastructure as Infrastructure as Code (IaC).\n\r ğŸ’¡ If you are not familiar with the tools and services in this guide, please refer to:\n  AWS Command Line Interface (CLI) â€“ Overview and Installation AWS SDK for Java â€“ Official Documentation AWS CloudFormation â€“ Basic Guide   ğŸš€ Implementation Contents In this section, you will step-by-step build the environment to automate networking on AWS:\n  Create IAM User and obtain Access Key, Secret Access Key, Public Key\nâ†’ Create an IAM User and configure authentication information (access key, secret key).\n  Create EC2 Instance and install AWS CLI\nâ†’ Create an EC2 instance, select an appropriate instance type, configure (VPC, Subnet, Security Group), choose or create a key pair for SSH access, and launch the instance.\n   ğŸ‘‰ After completing these steps, you will have a fully prepared environment to develop and deploy network automation solutions on the AWS platform efficiently and professionally.\n"},{"uri":"https://QuocTrong21.github.io/FCJ-WorkShop/3-awscli/","title":"Connect to EC2 servers","tags":[],"description":"","content":"In this step, we will connect to our EC2 servers, located in both the public and private subnets.\nContent 3.1. Connect to EC2 Public Server 3.2. Cconnect to EC2 Private Server\n"},{"uri":"https://QuocTrong21.github.io/FCJ-WorkShop/2-prerequiste/2.1.2-createec2/","title":"Triá»ƒn Khai Docker Image LÃªn AWS ECR TrÃªn Linux ","tags":[],"description":"","content":"ğŸ¯ Má»¥c TiÃªu HÆ°á»›ng dáº«n cÃ i Ä‘áº·t AWS CLI, cáº¥u hÃ¬nh tÃ i khoáº£n AWS, táº¡o repository trÃªn Amazon ECR, vÃ  Ä‘áº©y Docker image tá»« mÃ¡y local (bao gá»“m cáº£ image MySQL) lÃªn ECR.\n ğŸ§° 1. CÃ i Äáº·t AWS CLI TrÃªn Linux Cháº¡y cÃ¡c lá»‡nh sau Ä‘á»ƒ cÃ i Ä‘áº·t AWS CLI v2:\n# Táº£i AWS CLI v2 curl \u0026#34;https://awscli.amazonaws.com/awscli-exe-linux-x86_64.zip\u0026#34; -o \u0026#34;awscliv2.zip\u0026#34; # Giáº£i nÃ©n unzip awscliv2.zip # CÃ i Ä‘áº·t sudo ./aws/install # Kiá»ƒm tra phiÃªn báº£n aws --version  âš™ï¸ 2. Cáº¥u HÃ¬nh AWS CLI Sau khi cÃ i Ä‘áº·t, cháº¡y lá»‡nh sau Ä‘á»ƒ cáº¥u hÃ¬nh thÃ´ng tin tÃ i khoáº£n:\naws configure Nháº­p cÃ¡c thÃ´ng tin:\n AWS Access Key ID: tá»« IAM user AWS Secret Access Key: tá»« IAM user Default region name: ap-northeast-1 (hoáº·c vÃ¹ng báº¡n sá»­ dá»¥ng) Default output format: json   ğŸ“¦ 3. Táº¡o ECR Repository TrÃªn AWS Console  Truy cáº­p: https://console.aws.amazon.com/ecr Chá»n Repositories â†’ Create repository Nháº­p tÃªn repository: webenglish Chá»n Private, giá»¯ thiáº¿t láº­p máº·c Ä‘á»‹nh Nháº¥n Create repository  Báº¡n sáº½ nháº­n Ä‘Æ°á»£c URI nhÆ° sau:\n466322313916.dkr.ecr.ap-northeast-1.amazonaws.com/webenglish\r ğŸ— 4. XÃ¢y Dá»±ng Docker Image á»¨ng Dá»¥ng Di chuyá»ƒn Ä‘áº¿n thÆ° má»¥c cÃ³ Dockerfile vÃ  build image:\ndocker build -t webenglish-app .  ğŸ” 5. ÄÄƒng Nháº­p VÃ o Amazon ECR TrÆ°á»›c khi push, báº¡n cáº§n Ä‘Äƒng nháº­p vÃ o ECR:\naws ecr get-login-password --region ap-northeast-1 | \\ docker login --username AWS \\ --password-stdin 466322313916.dkr.ecr.ap-northeast-1.amazonaws.com  ğŸ· 6. Tag Docker Image Vá»›i ECR URI docker tag webenglish-app:latest \\ 466322313916.dkr.ecr.ap-northeast-1.amazonaws.com/webenglish:webenglish-app  ğŸš€ 7. Push Docker Image LÃªn ECR docker push \\ 466322313916.dkr.ecr.ap-northeast-1.amazonaws.com/webenglish:webenglish-app  ğŸ¬ 8. Äáº©y Image MySQL 8.0 LÃªn ECR (Tuá»³ chá»n) Náº¿u báº¡n Ä‘Ã£ pull/build image MySQL 8.0 vÃ  image ID lÃ  7d4e34ccfad4, báº¡n cÃ³ thá»ƒ tag vÃ  push nhÆ° sau:\nâœ… Gáº¯n tag MySQL image docker tag 7d4e34ccfad4 \\ 466322313916.dkr.ecr.ap-northeast-1.amazonaws.com/webenglish:mysql-8.0 ğŸ“Œ LÆ°u Ã½: Báº¡n cÃ³ thá»ƒ thay mysql-8.0 báº±ng latest náº¿u muá»‘n.\nâœ… Push MySQL image lÃªn ECR docker push \\ 466322313916.dkr.ecr.ap-northeast-1.amazonaws.com/webenglish:mysql-8.0 â³ KÃ­ch thÆ°á»›c image MySQL khoáº£ng 772MB â€” quÃ¡ trÃ¬nh push cÃ³ thá»ƒ máº¥t vÃ i phÃºt.\n ğŸ“‹ 9. Kiá»ƒm Tra TrÃªn AWS Console Sau khi push xong:\n Truy cáº­p láº¡i AWS Console â†’ ECR VÃ o repository webenglish XÃ¡c minh Ä‘Ã£ cÃ³ cÃ¡c image vá»›i tag: webenglish-app, mysql-8.0, v.v.   ğŸ“ 10. LÆ°u Ã Bá»• Sung  Docker cáº§n Ä‘Æ°á»£c cÃ i Ä‘áº·t vÃ  cháº¡y: sudo systemctl start docker  TÃ i khoáº£n IAM pháº£i cÃ³ quyá»n:  AmazonEC2ContainerRegistryFullAccess   Báº¡n cÃ³ thá»ƒ sá»­ dá»¥ng image tá»« ECR Ä‘á»ƒ triá»ƒn khai container trÃªn:  EC2 ECS EKS     ğŸ“š 11. TÃ i Liá»‡u Tham Kháº£o  AWS CLI Install Guide Amazon ECR Documentation Docker CLI Docs   "},{"uri":"https://QuocTrong21.github.io/FCJ-WorkShop/4-cloudformation/","title":"Triá»ƒn khai TÃ­nh nÄƒng Cáº£nh BÃ¡o vÃ  Pháº£n Há»“i Tá»± Äá»™ng cho WebEnglish","tags":[],"description":"","content":" ğŸš¨ Triá»ƒn khai Cáº£nh BÃ¡o vÃ  Pháº£n Há»“i Tá»± Äá»™ng vá»›i CloudWatch, SNS vÃ  Lambda TÃ i liá»‡u nÃ y hÆ°á»›ng dáº«n chi tiáº¿t cÃ¡ch tÃ­ch há»£p Amazon CloudWatch, SNS, Lambda, vÃ  (tuá»³ chá»n) DevOps Guru Ä‘á»ƒ phÃ¡t hiá»‡n báº¥t thÆ°á»ng vÃ  tá»± Ä‘á»™ng pháº£n á»©ng trong há»‡ thá»‘ng WebEnglish.\n ğŸ¯ Má»¥c TiÃªu  PhÃ¡t hiá»‡n báº¥t thÆ°á»ng hiá»‡u suáº¥t cá»§a EC2 hoáº·c ECS. Gá»­i cáº£nh bÃ¡o qua email vÃ  kÃ­ch hoáº¡t Lambda Ä‘á»ƒ pháº£n á»©ng. Tá»± Ä‘á»™ng Ä‘iá»u chá»‰nh sá»‘ lÆ°á»£ng task cá»§a dá»‹ch vá»¥ ECS hoáº·c khá»Ÿi Ä‘á»™ng láº¡i.   âœ… 1. Táº¡o CloudWatch Anomaly Detector Táº¡o trÃ¬nh phÃ¡t hiá»‡n báº¥t thÆ°á»ng cho chá»‰ sá»‘ cpu_usage_active trong namespace WebEnglishMetrics.\naws cloudwatch put-anomaly-detector \\ --namespace \u0026#34;WebEnglishMetrics\u0026#34; \\ --metric-name \u0026#34;cpu_usage_active\u0026#34; \\ --stat \u0026#34;Average\u0026#34; \\ --dimensions Name=InstanceId,Value=i-0817b4fd50252b509 \\ --region ap-northeast-1  âœ… 2. Táº¡o SNS Topic vÃ  ÄÄƒng kÃ½ Email Táº¡o má»™t SNS topic Ä‘á»ƒ gá»­i cáº£nh bÃ¡o vÃ  Ä‘Äƒng kÃ½ má»™t email Ä‘á»ƒ nháº­n thÃ´ng bÃ¡o.\naws sns create-topic --name WebEnglishAlerts --region ap-northeast-1 aws sns subscribe \\ --topic-arn arn:aws:sns:ap-northeast-1:\u0026lt;ACCOUNT_ID\u0026gt;:WebEnglishAlerts \\ --protocol email \\ --notification-endpoint your-email@example.com \\ --region ap-northeast-1  ğŸ“© Äá»«ng quÃªn xÃ¡c nháº­n email trong há»™p thÆ° Ä‘áº¿n Ä‘á»ƒ kÃ­ch hoáº¡t subscription.   âœ… 3. Táº¡o CloudWatch Alarm tá»« Anomaly Detector Táº¡o má»™t cáº£nh bÃ¡o Ä‘á»ƒ kÃ­ch hoáº¡t khi chá»‰ sá»‘ cpu_usage_active vÆ°á»£t quÃ¡ ngÆ°á»¡ng báº¥t thÆ°á»ng.\naws cloudwatch put-metric-alarm \\ --alarm-name CPUAnomalyAlarm \\ --evaluation-periods 2 \\ --datapoints-to-alarm 2 \\ --treat-missing-data notBreaching \\ --comparison-operator GreaterThanUpperThreshold \\ --metrics \u0026#39;[ { \u0026#34;Id\u0026#34;: \u0026#34;m1\u0026#34;, \u0026#34;MetricStat\u0026#34;: { \u0026#34;Metric\u0026#34;: { \u0026#34;Namespace\u0026#34;: \u0026#34;WebEnglishMetrics\u0026#34;, \u0026#34;MetricName\u0026#34;: \u0026#34;cpu_usage_active\u0026#34;, \u0026#34;Dimensions\u0026#34;: [ { \u0026#34;Name\u0026#34;: \u0026#34;InstanceId\u0026#34;, \u0026#34;Value\u0026#34;: \u0026#34;i-0817b4fd50252b509\u0026#34; } ] }, \u0026#34;Period\u0026#34;: 60, \u0026#34;Stat\u0026#34;: \u0026#34;Average\u0026#34; }, \u0026#34;ReturnData\u0026#34;: true }, { \u0026#34;Id\u0026#34;: \u0026#34;ad1\u0026#34;, \u0026#34;Expression\u0026#34;: \u0026#34;ANOMALY_DETECTION_BAND(m1, 2)\u0026#34;, \u0026#34;Label\u0026#34;: \u0026#34;AnomalyDetectionBand\u0026#34;, \u0026#34;ReturnData\u0026#34;: true } ]\u0026#39; \\ --threshold-metric-id ad1 \\ --alarm-actions arn:aws:sns:ap-northeast-1:\u0026lt;ACCOUNT_ID\u0026gt;:WebEnglishAlerts \\ --region ap-northeast-1  âœ… 4. Táº¡o Lambda Ä‘á»ƒ Scale ECS A. Táº¡o IAM Role Táº¡o IAM role LambdaScaleECSRole vá»›i chÃ­nh sÃ¡ch tin cáº­y cho Lambda.\naws iam create-role \\ --role-name LambdaScaleECSRole \\ --assume-role-policy-document file://trust-policy.json Ná»™i dung file trust-policy.json:\n{ \u0026#34;Version\u0026#34;: \u0026#34;2012-10-17\u0026#34;, \u0026#34;Statement\u0026#34;: [ { \u0026#34;Effect\u0026#34;: \u0026#34;Allow\u0026#34;, \u0026#34;Principal\u0026#34;: { \u0026#34;Service\u0026#34;: \u0026#34;lambda.amazonaws.com\u0026#34; }, \u0026#34;Action\u0026#34;: \u0026#34;sts:AssumeRole\u0026#34; } ] } B. Gáº¯n Policy cáº§n thiáº¿t Gáº¯n cÃ¡c chÃ­nh sÃ¡ch cáº§n thiáº¿t Ä‘á»ƒ Lambda cÃ³ thá»ƒ ghi log vÃ  tÆ°Æ¡ng tÃ¡c vá»›i ECS.\naws iam attach-role-policy \\ --role-name LambdaScaleECSRole \\ --policy-arn arn:aws:iam::aws:policy/service-role/AWSLambdaBasicExecutionRole aws iam attach-role-policy \\ --role-name LambdaScaleECSRole \\ --policy-arn arn:aws:iam::aws:policy/AmazonECS_FullAccess  âœ… 5. Táº¡o HÃ m Lambda scale_ecs_service.py HÃ m Python nÃ y sáº½ gá»i API cá»§a AWS Ä‘á»ƒ Ä‘iá»u chá»‰nh sá»‘ lÆ°á»£ng task mong muá»‘n cá»§a dá»‹ch vá»¥ ECS.\nimport boto3 def lambda_handler(event, context): ecs = boto3.client(\u0026#39;ecs\u0026#39;) cluster = \u0026#39;MyCluster\u0026#39; service = \u0026#39;WebenglishService\u0026#39; desired_count = 2 try: response = ecs.update_service( cluster=cluster, service=service, desiredCount=desired_count ) print(\u0026#34;Service updated:\u0026#34;, response[\u0026#39;service\u0026#39;][\u0026#39;serviceName\u0026#39;]) return { \u0026#39;statusCode\u0026#39;: 200, \u0026#39;body\u0026#39;: \u0026#39;Scaling executed\u0026#39; } except Exception as e: print(\u0026#34;Error:\u0026#34;, str(e)) return { \u0026#39;statusCode\u0026#39;: 500, \u0026#39;body\u0026#39;: str(e) } NÃ©n file:\nzip function.zip scale_ecs_service.py  âœ… 6. Táº¡o Lambda Function Táº¡o hÃ m Lambda cÃ³ tÃªn ScaleWebEnglish tá»« file nÃ©n vá»«a táº¡o.\naws lambda create-function \\ --function-name ScaleWebEnglish \\ --runtime python3.9 \\ --role arn:aws:iam::\u0026lt;ACCOUNT_ID\u0026gt;:role/LambdaScaleECSRole \\ --handler scale_ecs_service.lambda_handler \\ --zip-file fileb://function.zip \\ --timeout 10 \\ --region ap-northeast-1  âœ… 7. Gáº¯n Lambda vÃ o SNS vÃ  Cáº¥p Quyá»n ÄÄƒng kÃ½ Lambda vÃ o SNS topic Ä‘á»ƒ nÃ³ cÃ³ thá»ƒ Ä‘Æ°á»£c kÃ­ch hoáº¡t khi cÃ³ cáº£nh bÃ¡o.\naws sns subscribe \\ --topic-arn arn:aws:sns:ap-northeast-1:\u0026lt;ACCOUNT_ID\u0026gt;:WebEnglishAlerts \\ --protocol lambda \\ --notification-endpoint arn:aws:lambda:ap-northeast-1:\u0026lt;ACCOUNT_ID\u0026gt;:function:ScaleWebEnglish \\ --region ap-northeast-1 Cáº¥p quyá»n cho SNS gá»i Lambda:\naws lambda add-permission \\ --function-name ScaleWebEnglish \\ --statement-id snsInvokePermission \\ --action lambda:InvokeFunction \\ --principal sns.amazonaws.com \\ --source-arn arn:aws:sns:ap-northeast-1:\u0026lt;ACCOUNT_ID\u0026gt;:WebEnglishAlerts \\ --region ap-northeast-1  âœ… 8. (TÃ¹y chá»n) Táº¡o Step Function cho Scale ECS Sá»­ dá»¥ng Step Functions Ä‘á»ƒ táº¡o luá»“ng cÃ´ng viá»‡c tá»± Ä‘á»™ng.\nFile scale-ecs-step.json { \u0026#34;Comment\u0026#34;: \u0026#34;Scale ECS when high CPU\u0026#34;, \u0026#34;StartAt\u0026#34;: \u0026#34;ScaleService\u0026#34;, \u0026#34;States\u0026#34;: { \u0026#34;ScaleService\u0026#34;: { \u0026#34;Type\u0026#34;: \u0026#34;Task\u0026#34;, \u0026#34;Resource\u0026#34;: \u0026#34;arn:aws:states:::aws-sdk:ecs:updateService\u0026#34;, \u0026#34;Parameters\u0026#34;: { \u0026#34;Cluster\u0026#34;: \u0026#34;MyCluster\u0026#34;, \u0026#34;Service\u0026#34;: \u0026#34;WebenglishService\u0026#34;, \u0026#34;DesiredCount\u0026#34;: 2 }, \u0026#34;End\u0026#34;: true } } } Táº¡o role cho Step Function aws iam create-role \\ --role-name StepFunctionExecutionRole \\ --assume-role-policy-document file://stepfunction-trust-policy.json aws iam attach-role-policy \\ --role-name StepFunctionExecutionRole \\ --policy-arn arn:aws:iam::aws:policy/AmazonECS_FullAccess Táº¡o State Machine aws stepfunctions create-state-machine \\ --name ScaleWebEnglishStepFunction \\ --definition file://scale-ecs-step.json \\ --role-arn arn:aws:iam::\u0026lt;ACCOUNT_ID\u0026gt;:role/StepFunctionExecutionRole \\ --type STANDARD \\ --region ap-northeast-1  âœ… 9. Kiá»ƒm Thá»­ Há»‡ Thá»‘ng    Má»¥c tiÃªu CÃ¡ch kiá»ƒm thá»­     TÄƒng CPU stress-ng hoáº·c endpoint Spring Boot   Log Lambda CloudWatch Logs â†’ /aws/lambda/ScaleWebEnglish   Scale ECS Console â†’ WebenglishService   Hoáº¡t Ä‘á»™ng SNS Gá»­i thá»­ message báº±ng CLI    ğŸ”¹ TÄƒng CPU (Ubuntu): sudo apt update \u0026amp;\u0026amp; sudo apt install stress-ng -y stress-ng --cpu 2 --timeout 300s ğŸ”¹ Hoáº·c endpoint Spring Boot: @GetMapping(\u0026#34;/load-cpu\u0026#34;) public String loadCpu() { while (true) { Math.pow(Math.random(), Math.random()); } } Gá»i endpoint:\ncurl http://your-ecs-app/load-cpu ğŸ”¹ Test SNS â†’ Lambda: aws sns publish \\ --topic-arn arn:aws:sns:ap-northeast-1:\u0026lt;ACCOUNT_ID\u0026gt;:WebEnglishAlerts \\ --message \u0026#39;{\u0026#34;test\u0026#34;: \u0026#34;SNS to Lambda\u0026#34;}\u0026#39; \\ --region ap-northeast-1  âœ… 10. Máº¹o Debug \u0026amp; Tá»‘i Æ¯u    ThÃ nh pháº§n LÆ°u Ã½     Lambda ThÃªm xá»­ lÃ½ exception rÃµ rÃ ng vÃ  log chi tiáº¿t.   IAM Role Chá»‰ cáº¥p quyá»n tá»‘i thiá»ƒu cáº§n thiáº¿t Ä‘á»ƒ tuÃ¢n thá»§ nguyÃªn táº¯c Least Privilege.   ECS CÃ¢n nháº¯c sá»­ dá»¥ng chÃ­nh sÃ¡ch Target Tracking Policy thay vÃ¬ Ä‘iá»u chá»‰nh thá»§ cÃ´ng trong Lambda.   Alarm Äiá»u chá»‰nh evaluation-periods há»£p lÃ½ Ä‘á»ƒ trÃ¡nh cáº£nh bÃ¡o giáº£.    ğŸ“Œ Test thá»§ cÃ´ng Lambda náº¿u cáº§n:\naws lambda invoke \\ --function-name ScaleWebEnglish \\ --payload \u0026#39;{}\u0026#39; \\ output.json \\ --region ap-northeast-1 "},{"uri":"https://QuocTrong21.github.io/FCJ-WorkShop/5-java-sdk/","title":"Automated Response","tags":[],"description":"","content":"  ğŸš¨ Triá»ƒn Khai Há»‡ Thá»‘ng Cáº£nh BÃ¡o \u0026amp; Leo Thang Sá»± Cá»‘ ChuyÃªn Nghiá»‡p  Má»¥c tiÃªu: Há»‡ thá»‘ng cáº£nh bÃ¡o Ä‘a cáº¥p, tá»± Ä‘á»™ng phÃ¡t hiá»‡n báº¥t thÆ°á»ng, gá»­i cáº£nh bÃ¡o Ä‘áº¿n Ä‘Ãºng ngÆ°á»i, vÃ  tá»± pháº£n há»“i náº¿u cáº§n.\n  ğŸ“Œ 1. Thiáº¿t Káº¿ Quy TrÃ¬nh Cáº£nh BÃ¡o 3 Cáº¥p    Cáº¥p TÃªn NgÆ°á»i nháº­n Thá»i gian pháº£n há»“i CÃ´ng cá»¥     1 Cáº£nh bÃ¡o ká»¹ thuáº­t (DevOps) NhÃ³m DevOps â‰¤ 15 phÃºt Email / SNS   2 Cáº£nh bÃ¡o gáº¥p (On-call) Dev trá»±c hotline â‰¤ 5 phÃºt SNS + Lambda   3 Cáº£nh bÃ¡o quáº£n lÃ½ (Manager) Quáº£n lÃ½ cáº¥p cao Trong giá» hÃ nh chÃ­nh Email / SMS     ğŸ§ª 2. Táº¡o SNS Topic vÃ  Subscriptions 2.1 Táº¡o cÃ¡c SNS Topic aws sns create-topic --name WebEnglishAlert-Level1 aws sns create-topic --name WebEnglishAlert-Level2 aws sns create-topic --name WebEnglishAlert-Level3 2.2 ÄÄƒng kÃ½ Email vÃ o Topic (pháº£i xÃ¡c nháº­n) aws sns subscribe \\  --topic-arn arn:aws:sns:ap-northeast-1:\u0026lt;ACCOUNT_ID\u0026gt;:WebEnglishAlert-Level1 \\  --protocol email \\  --notification-endpoint devops@example.com aws sns subscribe \\  --topic-arn arn:aws:sns:ap-northeast-1:\u0026lt;ACCOUNT_ID\u0026gt;:WebEnglishAlert-Level3 \\  --protocol email \\  --notification-endpoint ceo@example.com  âœ… Kiá»ƒm tra email Ä‘á»ƒ xÃ¡c nháº­n (Confirm Subscription).   ğŸ“ˆ 3. Táº¡o CloudWatch Alarm - Level 1 aws cloudwatch put-metric-alarm \\  --alarm-name CPU-High-Level1 \\  --alarm-description \u0026#34;Cáº£nh bÃ¡o CPU cao - cáº¥p 1\u0026#34; \\  --metric-name cpu_usage_active \\  --namespace WebEnglishMetrics \\  --statistic Average \\  --period 300 \\  --evaluation-periods 1 \\  --threshold 80 \\  --comparison-operator GreaterThanThreshold \\  --actions-enabled \\  --alarm-actions arn:aws:sns:ap-northeast-1:\u0026lt;ACCOUNT_ID\u0026gt;:WebEnglishAlert-Level1  ğŸ›  4. Lambda Leo Thang 4.1 Táº¡o IAM Role cho Lambda trust-policy.json\n{ \u0026#34;Version\u0026#34;: \u0026#34;2012-10-17\u0026#34;, \u0026#34;Statement\u0026#34;: [{ \u0026#34;Effect\u0026#34;: \u0026#34;Allow\u0026#34;, \u0026#34;Principal\u0026#34;: { \u0026#34;Service\u0026#34;: \u0026#34;lambda.amazonaws.com\u0026#34; }, \u0026#34;Action\u0026#34;: \u0026#34;sts:AssumeRole\u0026#34; }] } aws iam create-role \\  --role-name LambdaAlertEscalatorRole \\  --assume-role-policy-document file://trust-policy.json aws iam attach-role-policy \\  --role-name LambdaAlertEscalatorRole \\  --policy-arn arn:aws:iam::aws:policy/CloudWatchReadOnlyAccess aws iam attach-role-policy \\  --role-name LambdaAlertEscalatorRole \\  --policy-arn arn:aws:iam::aws:policy/AmazonSNSFullAccess  4.2 MÃ£ Lambda: alert_escalator.py import boto3 def lambda_handler(event, context): cloudwatch = boto3.client(\u0026#39;cloudwatch\u0026#39;) sns = boto3.client(\u0026#39;sns\u0026#39;) alarm_name = \u0026#34;CPU-High-Level1\u0026#34; response = cloudwatch.describe_alarms(AlarmNames=[alarm_name]) if response[\u0026#39;MetricAlarms\u0026#39;] and response[\u0026#39;MetricAlarms\u0026#39;][0][\u0026#39;StateValue\u0026#39;] == \u0026#34;ALARM\u0026#34;: sns.publish( TopicArn=\u0026#34;arn:aws:sns:ap-northeast-1:\u0026lt;ACCOUNT_ID\u0026gt;:WebEnglishAlert-Level2\u0026#34;, Subject=\u0026#34;ğŸš¨ Cáº£nh bÃ¡o leo thang\u0026#34;, Message=f\u0026#34;Alarm {alarm_name}váº«n chÆ°a Ä‘Æ°á»£c xá»­ lÃ½. Äang leo thang lÃªn cáº¥p 2.\u0026#34; )  4.3 Deploy Lambda Function zip function.zip alert_escalator.py aws lambda create-function \\  --function-name alertEscalator \\  --runtime python3.12 \\  --role arn:aws:iam::\u0026lt;ACCOUNT_ID\u0026gt;:role/LambdaAlertEscalatorRole \\  --handler alert_escalator.lambda_handler \\  --zip-file fileb://function.zip \\  --timeout 10  âœ… Báº¡n cÃ³ thá»ƒ test thá»­ báº±ng AWS Console â†’ Lambda â†’ Test   ğŸ“ˆ 5. Táº¡o Alarm Gá»i Lambda - Level 2 aws cloudwatch put-metric-alarm \\  --alarm-name CPU-High-Level2 \\  --alarm-description \u0026#34;Leo thang cáº£nh bÃ¡o CPU cao\u0026#34; \\  --metric-name cpu_usage_active \\  --namespace WebEnglishMetrics \\  --statistic Average \\  --period 600 \\  --evaluation-periods 2 \\  --threshold 80 \\  --comparison-operator GreaterThanThreshold \\  --actions-enabled \\  --alarm-actions arn:aws:lambda:ap-northeast-1:\u0026lt;ACCOUNT_ID\u0026gt;:function:alertEscalator  ğŸ” Tá»•ng Quan Leo Thang    Cáº¥p Alarm Äiá»u kiá»‡n HÃ nh Ä‘á»™ng     1 CPU-High-Level1 1 Ã— 5 phÃºt \u0026gt; 80% Gá»­i SNS Level 1 â†’ DevOps   2 CPU-High-Level2 2 Ã— 10 phÃºt \u0026gt; 80% Gá»i Lambda â†’ gá»­i SNS Level 2 (gá»i ngÆ°á»i trá»±c hotline)   3 (tÃ¹y chá»n má»Ÿ rá»™ng) KhÃ´ng xá»­ lÃ½ sau 30p Gá»­i SNS Level 3 â†’ quáº£n lÃ½ cáº¥p cao qua email/sms     ğŸ“Š 6. CloudWatch Anomaly Detection (TÃ¹y chá»n nÃ¢ng cao) aws cloudwatch put-anomaly-detector \\  --namespace WebEnglishMetrics \\  --metric-name cpu_usage_active \\  --statistic Average \\  --dimensions Name=InstanceId,Value=i-xxxxxx  ğŸŒ€ 7. Step Functions (TÃ¹y chá»n tá»± Ä‘á»™ng pháº£n há»“i) Sá»­ dá»¥ng Ä‘á»ƒ:\n Scale ECS Service Reboot EC2 Instance Gá»­i chuá»—i hÃ nh Ä‘á»™ng khi phÃ¡t hiá»‡n sá»± cá»‘   ğŸ§ª 8. Kiá»ƒm thá»­ há»‡ thá»‘ng sudo yum install -y stress-ng stress-ng --cpu 4 --timeout 600s Báº¡n cÃ³ thá»ƒ gá»­i metric giáº£ vÃ o CloudWatch Ä‘á»ƒ test há»‡ thá»‘ng hoáº¡t Ä‘á»™ng:\naws cloudwatch put-metric-data \\  --metric-name cpu_usage_active \\  --namespace WebEnglishMetrics \\  --value 90 Kiá»ƒm tra:\n SNS gá»­i Ä‘Ãºng ngÆ°á»i? Lambda cÃ³ Ä‘Æ°á»£c kÃ­ch hoáº¡t? Escalation cÃ³ Ä‘Æ°á»£c thá»±c hiá»‡n? Email xÃ¡c nháº­n Ä‘Ã£ Ä‘Æ°á»£c nháº¥n chÆ°a?   ğŸ“˜ 9. Tá»•ng Káº¿t âœ… Há»‡ thá»‘ng cáº£nh bÃ¡o nhiá»u cáº¥p hoáº¡t Ä‘á»™ng chuáº©n:\n CloudWatch theo dÃµi \u0026amp; phÃ¡t hiá»‡n báº¥t thÆ°á»ng SNS phÃ¢n táº§ng cáº£nh bÃ¡o Ä‘Ãºng ngÆ°á»i Lambda pháº£n á»©ng khi cáº£nh bÃ¡o chÆ°a Ä‘Æ°á»£c xá»­ lÃ½ Má»Ÿ rá»™ng vá»›i Step Functions, PagerDuty, EC2 auto recovery\u0026hellip;    ğŸ§© Gá»£i Ã½ nÃ¢ng cao  DÃ¹ng CloudFormation / CDK Ä‘á»ƒ mÃ£ hÃ³a toÃ n bá»™ háº¡ táº§ng nÃ y Ghi log vÃ o CloudWatch Logs Ä‘á»ƒ tracking escalation Táº¡o Dead Letter Queue cho Lambda náº¿u bá»‹ lá»—i   "},{"uri":"https://QuocTrong21.github.io/FCJ-WorkShop/6-cleanup/","title":"Clean Up Resources","tags":[],"description":"","content":"We will proceed to clean up all AWS resources created during the practice session. Please follow the steps below to avoid incurring unnecessary charges.\n âœ… Delete DevOps Guru  Go to the DevOps Guru Console On the left menu, choose Settings. Under CloudFormation stacks, click Delete for the DevOps Guru stack you activated. Confirm deletion if prompted.   âœ… Destroy CDK Stack using cdk destroy  Open the terminal in the directory containing your CDK project. Run the following command to destroy the CDK stack: cdk destroy  When prompted, type y and press Enter. Wait for the stack destruction to complete.    âœ… Delete S3 Bucket  Go to the S3 Console Select the buckets you created (e.g., cdk-bucket-*, log-bucket-*, etc.). Perform the following steps:  Click Empty â†’ Type permanently delete â†’ Click Empty. Then, click Delete â†’ Enter the bucket name â†’ Click Delete bucket.     âœ… Delete CloudFormation Stack (if not using CDK)  Go to the CloudFormation Console Select the stacks related to the lab (e.g., DevOpsGuruStack, CDKStack, etc.). Click Delete and confirm deletion.   âœ… Delete CloudWatch Logs / Alarms / Dashboards  Go to the CloudWatch Console  Delete Log Groups:\n Go to Logs \u0026gt; Log groups Select the log groups (e.g., /aws/lambda/..., /aws/events/...) Click Actions \u0026gt; Delete log groups  Delete Alarms:\n Go to Alarms \u0026gt; All alarms Select all alarms â†’ Click Actions \u0026gt; Delete  Delete Dashboards:\n Go to Dashboards Select dashboard â†’ Click Actions \u0026gt; Delete    âœ… Terminate EC2 Instances  Go to the EC2 Console Go to Instances Select the instances to delete â†’ Click Instance state \u0026gt; Terminate instance Confirm Terminate    âœ… Delete VPC  Go to the VPC Console Go to Your VPCs Select the VPC you created â†’ Click Actions \u0026gt; Delete VPC Confirm deletion   âœ… Delete Subnets (if not automatically removed with VPC)  In the VPC Console â†’ Go to Subnets Select the related subnets (Public, Private) â†’ Click Actions \u0026gt; Delete subnet    âœ… Note: After cleaning up, go to the Billing Dashboard to check for any remaining resources and ensure no extra costs are incurred.\n  "},{"uri":"https://QuocTrong21.github.io/FCJ-WorkShop/categories/","title":"Categories","tags":[],"description":"","content":""},{"uri":"https://QuocTrong21.github.io/FCJ-WorkShop/tags/","title":"Tags","tags":[],"description":"","content":""}]